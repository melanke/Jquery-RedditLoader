(function(a){var b=function(b,c){var d;var e;var f;var g;var h=false;var i=0;var j=function(){c=a.extend(b.data(),c);if(!c.render)c.render=t;if(!c.minDelay)c.minDelay=3e3;if(!c.maxImgurAlbumItens)c.maxImgurAlbumItens=5;if(c.skipPage===undefined)c.skipPage=true;d=(c.subreddits||"").split("/");e=[];f=[];g=-1;m()};this.resume=function(){h=false;m()};var k=this.resume;this.pause=function(){h=true};var l=this.pause;var m=function(){if(h)return;if(!d||!d.length||g<0)g=0;else g=(g+1)%d.length;if(e[g]&&e[g].length>0){var a=Math.max(c.minDelay+i-Date.now(),1);i=Date.now();setTimeout(function(){o(e[g][0],function(a){if(a)c.render(e[g][0].data,t);e[g].splice(0,1);m()})},a)}else{var b=null;if(f&&f[g])b=f[g];n(d[g],b,function(a){if(a&&a.length){e[g]=a;f[g]=a[a.length-1].data.name}else{d.splice(g,1);g--}m()})}};var n=function(d,e,f){var g="http://www.reddit.com/";if(d)g+="r/"+d;if(c.redditSort)g+="/"+c.redditSort;g+=".json?jsonp=?";if(e)g+="&after="+e;a(b).trigger("beforeSubredditLoad",[g]);a.getJSON(g,function(c){a(b).trigger("successSubredditLoad",[g]);f(c.data.children)}).error(function(){a(b).trigger("errorSubredditLoad",[g]);f(null)})};var o=function(d,e){a(b).trigger("beforePostLoad",[d.data.url]);var f=d.data.url;if(c.skipNsfw&&d.data.over_18){a(b).trigger("skipPostLoad",[d.data.url,"nsfw"]);e(false);return}if(d.data.selftext_html){if(c.skipText){a(b).trigger("skipPostLoad",[d.data.url,"text"]);e(false)}else{a(b).trigger("successPostLoad",[d.data.url]);e(true)}return}if(c.skipGifs&&f.indexOf(".gif")!=-1){a(b).trigger("skipPostLoad",[d.data.url,"gif"]);e(false);return}if(f.indexOf(".jpeg")!=-1||f.indexOf(".jpg")!=-1||f.indexOf(".png")!=-1||f.indexOf(".gif")!=-1){a("<img />").attr("src",d.data.url).load(function(){a(b).trigger("successPostLoad",[d.data.url]);e(true)}).error(function(){a(b).trigger("errorPostLoad",[d.data.url]);e(false)});return}if(f.indexOf("imgur.com/a/")!=-1){if(c.skipImgurAlbum){a(b).trigger("skipPostLoad",[d.data.url,"imgur"]);e(false)}else{q(d,f,e)}return}if(f.indexOf("imgur")!=-1){p(d,f,e);return}var g=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;var h=f.match(g);if(h&&h[2].length==11){if(c.skipYoutube){a(b).trigger("skipPostLoad",[d.data.url,"youtube"]);e(false)}else{d.data.youtube=h[2];e(true);return}}if(c.skipPage){a(b).trigger("skipPostLoad",[d.data.url,"page"]);e(false)}else{d.data.page=true;a(b).trigger("successPostLoad",[d.data.url]);e(true)}};var p=function(c,d,e){var f=d.split("/");var g=f[f.length-1];var h="http://api.imgur.com/2/image/"+g+".json";a.getJSON(h,function(d){a("<img />").attr("src",d.image.links.original).load(function(){c.data.url=d.image.links.original;a(b).trigger("successPostLoad",[d.image.links.original]);e(true)}).error(function(){a(b).trigger("errorPostLoad",[d.image.links.original]);e(false)})}).error(function(){a(b).trigger("errorPostLoad",[h]);e(false)})};var q=function(d,e,f){var g=e.split("/");var h=g[g.length-1];var i="http://api.imgur.com/2/album/"+h+".json";a.getJSON(i,function(g){d.data.imgur=[];if(c.maxImgurAlbumItens>-1&&c.maxImgurAlbumItens<g.album.images.length){a(b).trigger("skipPostLoad",[e,"imgur max"]);f(false);return}r(d.data.imgur,g.album.images,0,f)}).error(function(){a(b).trigger("errorImgurLoad",[e]);f(false)})};var r=function(a,b,c,d){s(b[c].links.original,function(e){if(e){a.push(b[c].links.original);c++;if(c>b.length-1)d(true);else r(a,b,c,d)}else{d(false)}})};var s=function(c,d){a("<img />").attr("src",c).load(function(){a(b).trigger("successImgurItemLoad",[c]);d(true)}).error(function(){a(b).trigger("errorImgurItemLoad",[c]);d(false)})};var t=function(c){if(c.youtube){a(b).append("<h1><span class='subreddit'>"+c.subreddit+"</span>"+c.title+"</h1><iframe type='text/html' width='640' height='390' src='http://www.youtube.com/embed/"+c.youtube+"' frameborder='0'/><hr/>");l();setTimeout(k,6e3)}else if(c.imgur){a(b).append("<h1><span class='subreddit'>"+c.subreddit+"</span>"+c.title+"</h1>");for(var d in c.imgur){a(b).append("<img src='"+c.imgur[d]+"'/><br/>")}a(b).append("<hr/>")}else if(c.selftext_html){a(b).append("<h1><span class='subreddit'>"+c.subreddit+"</span>"+c.title+"</h1>"+a("<div/>").html(c.selftext_html).text()+"<hr/>")}else if(c.page){a(b).append("<h1><span class='subreddit'>"+c.subreddit+"</span>"+c.title+"</h1><iframe src='"+c.url+"'/><hr/>");l();setTimeout(k,6e3)}else{a(b).append("<h1><span class='subreddit'>"+c.subreddit+"</span>"+c.title+"</h1><img src='"+c.url+"'/><hr/>")}};j()};a.fn.redditloader=function(c){this.each(function(){var d=a(this).data("redditloader");if(!d)d=new b(a(this),c);if(c===true)d.resume();else if(c===false)d.pause();a(this).data("redditloader",d)})}})(jQuery)